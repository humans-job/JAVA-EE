# JAVA-EE
大三小学期任务

## 1、系统总体架构

核心思路：分层+微服务混合架构，按照业务模块拆分子服务，内部采用分层架构。从而兼顾模块化复用、独立部署和权限隔离，适配民兵系统的层级管理需求。

### 1.1 架构分层

- **表现层**：Vue + Vue Router + Element UI（地图用 Leaflet / 高德 API）

- **网关层**：Spring Cloud Gateway（统一认证、路由转发、限流，适配单点登录）

- 业务服务层

  ：按 6 大模块拆分为 6 个微服务（可合并通用模块）

  - 地图态势服务（模块一）
  - 档案管理服务（模块二）
  - 通知教育服务（模块三）
  - 报表管理服务（模块四）
  - 请销假服务（模块五）
  - 认证安全服务（模块六）

- **数据访问层**：MyBatis-Plus（适配数据库表结构，简化 CRUD）

- **数据存储层**：MySQL（业务数据）

## 2、各模块详细设计

### 模块一：各级单位地图与态势感知（兵团机关核心）

#### 1. 功能流程

1. 各级管理员（兵团 / 师 / 团）登录后，基于权限进入地图模块；
2. 区域划定：各组织管理员用绘图工具（方形 / 圆形 / 多边形）绘制管辖区域，数据存入`sys_dept.region_shape`；
3. 态势查询：
   - 营 / 连 / 团 / 师级：按条件查询下属组织 / 人员，以 “列表 + 基础地图” 展示；
   - 兵团级：聚合全疆数据，以地图为基准渲染态势分布（人员数量、区域覆盖等）。

#### 2. 模块核心功能

- 区域管理：绘制 / 编辑 / 删除管辖区域，关联对应部门；
- 多维度查询：按部门层级、人员状态、区域范围筛选数据；
- 可视化展示：兵团级地图态势渲染，师 / 团级列表 + 简易地图展示；

#### 3. 接口设计（RESTful）

| 请求方式 | 接口路径 | 功能描述     | 核心参数                                                     | 返回示例                                 |
| -------- | -------- | ------------ | ------------------------------------------------------------ | ---------------------------------------- |
| POST     |          | 保存管辖区域 | deptId (部门 ID)、shapeType (1 = 方形 / 2 = 圆形 / 3 = 多边形)、shapeData (坐标 JSON) | `{code:200, msg:"保存成功", data:{...}}` |
| GET      |          | 态势数据查询 | deptId、deptLevel (1 = 兵团 / 2 = 师 / 3 = 团 / 4 = 营连)    | `{code:200, msg:"查询成功", data:{...}}` |

### 模块二：民兵档案管理

#### 1. 功能流程

1. 团机关批量导入民兵信息，数据存入`biz_militia_info`（`audit_status=0`，草稿）；
2. 团机关提交审核，系统更新`audit_status=1`（待师部审核），关联`audit_dept`（师部 ID）；
3. 师机关审核：通过则`audit_status=2`（已归档），驳回则`audit_status=3`并填写`audit_feedback`；
4. 归档后，团机关维护本团数据，师机关管理所有下属数据。

#### 2. 模块核心功能

- 批量导入：Excel 模板导入，自动校验身份证 / 手机号格式；
- 审核流程：团提交→师审核→状态更新；
- 档案维护：按权限新增 / 编辑 / 删除民兵信息；

#### 3. 接口设计

| 请求方式 | 接口路径 | 功能描述     | 核心参数                                                     | 返回示例                                                     |
| -------- | -------- | ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| POST     |          | 批量导入档案 | file (文件流)、deptId (团部门 ID)                            | `{code:200, msg:"导入成功，共50条，成功48条", data:{failList:[{idCard:"xxx", reason:"手机号格式错误"}]}}` |
| POST     |          | 提交师部审核 | ids (民兵 ID 列表)、auditDeptId (师部 ID)                    | `{code:200, msg:"提交成功，待师部审核"}`                     |
| POST     |          | 师部审核档案 | id、auditStatus (2 = 通过 / 3 = 驳回)、auditFeedback (驳回必填) | `{code:200, msg:"审核完成"}`                                 |
| GET      |          | 查询档案列表 | deptId、auditStatus、idCard (模糊)、pageNum/pageSize         | `{code:200, msg:"查询成功", data:{list:[...], total:45}}`    |
| PUT      |          | 编辑档案     | id、idCard、phone、address 等字段                            | `{code:200, msg:"编辑成功", data:{id:1001}}`                 |
| DELETE   |          | 删除档案     | id                                                           | `{code:200, msg:"删除成功"}`                                 |

### 模块三：通知公告与教育

#### 1. 功能流程

1. 师机关发布通知，数据存入`biz_notice`；
2. 系统按接收范围，为对应用户创建`biz_notice_record`（`is_read=0`）；
3. 团机关 / 民兵阅读后，系统更新`is_read=1`并记录`read_time`；
4. 师机关查看已读 / 未读统计，向未读用户发送催办提醒；
5. 通知完成后，更新`biz_notice.status=1`（完成）。

#### 2. 模块核心功能

- 通知发布：富文本编辑（可选），选择类型，按照接收范围发布通知；
- 通知查看：查看上级组织发布的通知；
- 阅读反馈：查看单条通知的已读 / 未读用户列表及统计；
- 消息催办：向未读用户发送站内信 / 短信提醒。

#### 3. 接口设计

| 请求方式 | 接口路径 | 功能描述     | 核心参数                                                     | 返回示例                                                  |
| -------- | -------- | ------------ | ------------------------------------------------------------ | --------------------------------------------------------- |
| POST     |          | 发布通知     | title、content、noticeType (1 = 公告 / 2 = 教育)、senderDeptId (师部 ID)、receiveDeptIds (接收团 ID 列表) | `{code:200, msg:"发布成功", data:{...}}`                  |
| GET      |          | 查询通知列表 | noticeType、pageNum/pageSize                                 | `{code:200, msg:"查询成功", data:{list:[...], total:20}}` |
| PUT      |          | 标记已读     | noticeId、userId (当前用户)                                  | `{code:200, msg:"标记成功"}`                              |
| GET      |          | 阅读反馈查询 | noticeId、readStatus (0 = 未读 / 1 = 已读)                   | `{code:200, msg:"查询成功", data:{userList:[...]}}`       |
| POST     |          | 催办提醒     | noticeId、userIds (未读用户列表)                             | `{code:200, msg:"提醒发送成功", data:{count:200}}`        |

### 模块四：工作与报表管理

#### 1. 功能流程

1. 系统按规则向营 / 连推送填报任务；(可选)
2. 营 / 连管理员填写报表，提交后存入`biz_work_report`（`status=0`，待审批）；
3. 团机关审批：通过则`status=1`（已归档），驳回则`status=2`；
4. 归档后，师机关以上可查询所有报表。

#### 2. 模块核心功能

- 任务推送：配置规则，自动推送月计划 / 总结 / 专项活动填报任务；(可选)
- 报表填报：在线编辑内容，上传 Word/PDF 附件；
- 审批管理：团机关审批报表；
- 归档查询：按部门、类型、月份筛选报表，支持附件下载；

#### 3. 接口设计

| 请求方式 | 接口路径 | 功能描述     | 核心参数                                                     | 返回示例                                                  |
| -------- | -------- | ------------ | ------------------------------------------------------------ | --------------------------------------------------------- |
| POST     |          | 提交报表     | deptId (营连 ID)、title、content、filePath、reportType (1 = 月计划 / 2 = 月总结 / 3 = 专项)、reportMonth | `{code:200, msg:"提交成功", data:{...}}`                  |
| POST     |          | 审批报表     | reportId、status (1 = 通过 / 2 = 驳回)、approveBy (审批人 ID) | `{code:200, msg:"审批完成"}`                              |
| GET      |          | 查询报表列表 | deptId、reportType、reportMonth、status、pageNum/pageSize    | `{code:200, msg:"查询成功", data:{list:[...], total:50}}` |

### 模块五：请销假管理

#### 1. 功能流程

1. 民兵填写请假信息，提交后存入`biz_leave`（`status=0`，待审批）；
2. 营 / 连管理员审批：通过则`status=1`（待销假），驳回则`status=2`；
3. 民兵归队后点击销假，系统记录`report_back_time`（当前时间）、`report_back_location`（定位）；
4. 管理员确认销假，更新`status=3`（已归档）；
5. 系统每月自动汇总请销假数据，生成台账。

#### 2. 模块核心功能

- 请假申请：自动补全所属部门、审批人等信息；
- 审批管理：查看待审批列表，审批通过 / 驳回并填写意见；
- 销假操作：民兵自助销假（抓时间 / 定位），管理员确认；
- 台账汇总：按月生成请销假台账，支持查询 / 导出。

#### 3. 接口设计

| 请求方式 | 接口路径 | 功能描述       | 核心参数                                                     | 返回示例                                                     |
| -------- | -------- | -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| POST     |          | 提交请假申请   | userId、deptId、reason、startTime、endTime                   | `{code:200, msg:"申请提交成功"}`                             |
| POST     |          | 审批请假       | leaveId、status (1 = 通过 / 2 = 驳回)、approveBy、approveOpinion | `{code:200, msg:"审批完成"}`                                 |
| PUT      |          | 民兵销假       | leaveId、reportBackLocation (定位)、userId                   | `{code:200, msg:"销假提交成功"}`                             |
| POST     |          | 确认销假       | leaveId、confirmBy (确认人 ID)                               | `{code:200, msg:"销假确认成功"}`                             |
| GET      |          | 查询请销假台账 | deptId、month (如 2025-12)、pageNum/pageSize                 | `{code:200, msg:"查询成功", data:{list:[...], stat:{applyCount:20, passCount:18}}}` |

### 模块六：统一认证与安全

#### 1. 功能流程

1. 用户选择认证方式（账号密码 / USB Key / 数字证书）登录；
2. 系统校验：账号密码（`sys_user.username/password`）、USB Key（`usb_key`）、数字证书（`cert_sn`）；
3. 认证通过后生成 Token，前端携带 Token 访问接口，后端校验 Token 及权限；
4. 前端通过 Vue 路由守卫，按用户权限控制页面访问。

#### 2. 模块核心功能

- 多因子认证：支持账号密码、USB Key、数字证书三种方式；
- 单点登录：Token 跨子系统共享，一次登录全网通行；
- 权限隔离：接口 + 页面双重鉴权，基于部门层级 / 用户类型控制访问；
- 登录日志：记录登录 IP / 时间，异常登录提醒。

#### 3. 接口设计

| 请求方式 | 接口路径 | 功能描述 | 核心参数                                                     | 返回示例                                                     |
| -------- | -------- | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| POST     |          | 用户登录 | authType (1 = 账号密码 / 2=USB Key/3 = 证书)、username/password/usbKey/certSn | `{code:200, msg:"登录成功", data:{token:"xxx", userId:1001, deptLevel:2, menus:[...]}}` |
| POST     |          | 退出登录 | token                                                        | `{code:200, msg:"退出成功"}`                                 |
| GET      |          | 权限校验 | path (页面路径)、token                                       | `{code:200, msg:"有权限", data:{hasPermission:true}}`        |